# js files
## [/adminFeedbackMain.js/](feedback.md#adminFeedbackMainjs-1)
## [/adminFeedbackTags.js/](feedback.md#adminFeedbackTagsjs-1)
## [/calendar_daterange.js/](feedback.md#calendar_daterangejs-1)

### adminFeedbackMain.js
#### Основной файл для отрисовки звонков и тэгов в фидбеке  
#### Функции
1.  [/getCalls()/](feedback.md#getCalls)
2.  [/createTagsTable()/](feedback.md#createTagsTable)
3.  [/document.ready()/](feedback.md#afm-documentready) 

#### Глобальные переменные
1. catNum - категория вопроса, для сортировки
##### getCalls()
Функция, которая получает все звонки за конкретный период, а потом, на основании выбранных значений, фильтрует их для вывода. Для корректной работы нужно выбрать 3 параметра - категорию (по умолчанию All), дату (по умолчанию - сегодня) и тэги (по умолчанию - пустой списк), а также выбрать режим работы (только feedback или просто обновленные звонки, сделано для просмотра звонков unhappy и просмотра просто тэгированных звонков) - и нажать кнопку GO. После этого идет обращение к базе. Происходит очистка рабочих переменных и сортировка звонков от новых к старым.
Запускается основной цикл:
Сборка тэгов, проверка на наличие тэгов в звонках и проверка условия 
```sh
if( (catNum==6||catNum==feedbackInfo[i].shopCategoryId-1) && tagCheck )
```
После этого начинается сборка вывода: звонок, комментарий и тэги. Звонок, если состоит из 1+ частей комплектуется в один, также на него наносится информация о категории и ID, помимо даты и имени агента.
#### createTagsTable()
Отрисовывает блок с выбором тэга.
Сбрасывает счетчик тэгов и текст. Делает запрос по тэгам и начинает строить блок. В зависимости от количества групп отрисовывает немного по-разному, четное или нечетное количество. Пробегает по циклу, не выводя группу Unfiltered и пустые группы. Выбирает из запроса название группы, название тэга и выводит их, отрисовывая их как в админке. Добавляет информацию блоками, в конце склеивая их. После этого отрисовывает нижние кнопки.
#### afm-document.ready() 
Запрос к базе на получений категорий, jQuery контроль нажатия клавиши категории и отрисовка таблицы с тегами.

### adminFeedbackTags.js
#### Основной файл для работы с тэгами на странице Feedback. Работа кнопок, карта тэгов, вывод информации, подсчет и так далее
#### Функции
1.  [/document.ready()/](feedback.md#aft-documentready)
2.  [/toggle()/](feedback.md#toggle)
3. [/clickOnLabel(id)/](feedback.md#clickOnLabelid)
4.  [/checkAllButton()/](feedback.md#checkAllButton)
5.  [/clearButton()/](feedback.md#clearButton)
6.  [/TagActiveChecker()/](feedback.md#TagActiveChecker)

#### Глобальные переменные
1. tagsMap - хранит в себе выбранные тэги, с которыми потом идет сравнение
2. tagCounter - хранит в себе количество тэгов. Выводится в спец. поле
3. tagSum - максимальное количество тэгов, предназначено для вывода фразы - выбраны все тэги.

#### aft-document.ready()
Проверяет количество тэгов при запуске, убирает срабатывание закрытия формы.
#### toggle()
Кривая функция, которую нужно переписать. Нужна для корректной работы переключателя режима вывода звонков. вкл\выкл
#### clickOnLabel(id)
обрабатывает нажатия на лейбл тэга. Добавляет тэгу класс blueOne и устанавливает лейблу атрибут checked, После этого обновляет информацию по количеству активных тэгов.
#### checkAllButton
делает тоже самое, что и clickOnLabel, но в цикле и для всех кнопок тэгов
#### clearButton
обратное действие, убирает со всех выделение в цикле
#### TagActiveChecker
Главная функция. Создает мапу тэгов, при каждом вызове, в которую добавляет информацию о выбранных тэгах. После этого, в цикле проходит все тэги и смотрит на наличие класса blueOne. При наличии плюсует в количество активных тэгов и добавляет название тэга в общую строку вывода. При совпадении количества выбранных тэгов с максимальным количеством тэгов(проверка tagSum) выводит фразу - выбраны все тэги.

# css files
## [/adminFeedback.css/](feedback.md#adminFeedbackcss-1)
## [/calls.css/](feedback.md#callscss-1)
## [/feedback-tags-main.css/](feedback.md#feedback-tags-maincss-1)
## [/feedback-tags-admin.css/](feedback.md#feedback-tags-admincss-1)

### adminFeedback.css
Содержит в себе стили:
1. Основная обертка (page-content-wrapper)
2. Основное рабочее поле (MainForm)
3. Отрисовку блока комментарий (.comments,\#noteArea, .might-overflow + .might-overflow:hover, .cursor-def)
4. Отрисовка тэгов (.tags, \#tagInfo)
5. Манипуляции с высотой и расположением блоков (.li-centered, .same-height, .full-height, .add-height)

### calls.css
общий файл для отрисовки звонка. Содержит в себе всю информацию - как звонок рисуется(.call), как он выглядит активным(.call.active), аудио-тэг (.audio-call), отступы (.no-margin-top), подсветка твоих звонков (.yourCall) , дополнительная информация на звонках (.myLabel, .myLabel>a, mylabel>a:link|visited) и комментариев к звонкам (.might-overflow|:hover, .commentBox)
### feedback-tags-main.css
Файл с совпадающими параметрами для feedbacka и для основной части сайта для отображения блоков тэгов. Группы, строки, блоки, реакция на наведение, отношение разных блоков по отношению друг к другу
### feedback-tags-admin.css
Описание отображение выпадающего блока с тэгами. Все подробно закомметировано в самом файле. Главная форма, хедер, контейнер, первый блок контейнера, колонки и группы