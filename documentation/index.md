# js files
## Написанные
### [clientCalls.js](index.md#clientcallsjs-1)
### [fireFeedback.js](index.md#firefeedbackjs-1)
### [navbar.js](index.md#navbarjs-1)
### [notesAndComments.js](index.md#notesandcommentsjs-1)
### [todayCallsController.js](index.md#todaycallscontrollerjs-1)
### [webSocket.js](index.md#websocketjs-1)
___
## Внешние
### jquery.min.js (3.1.1) 
### bootstrap.min.js (3.3.7)
### moment.js (latest) 
для работы с датами
### daterangepicker (2) 
для работы с календарем
### bootstrap-toggle.min.js (2.2.2)
переключатель
___
## Общие
### [calendar.js](common.md#calendarjs-1)
### [commonData.js](common.md#commonDatajs-1)
___
### clientCalls.js
#### Файл, отвечающий за отрисовку звонков пользователей.
#### Функции
1.  [document.ready()](index.md#cc-documentready)
2.  [getCalls()](index.md#getcalls)
3.  [drawClientCalls(page)](index.md#drawclientcallspage)
4.  [collectTagForGetCalls(data)](index.md#collecttagforgetcallsdata)
5.  [addButton()](index.md#addbutton)

#### Глобальные переменные
callsData - информация о всех звонках. Из-за структуры файла вынесена в глобальную переменную.
##### cc-document.ready()
содержит в себе логику обработки события нажатия на кнопку Звонки пользователя, а именно - стандартное заполнение информации, отрисовка поля с кнопкой и расширение основного поля на весь (оставшийся) экран.
##### getCalls()
Подфункция запрос, с передачей информации в уже, собственно, отрисовку ->(drawClientCalls). Сохраняет в переменные id учетной записи и осуществляет get запрос стандартный, попутно сортируя данные. Запрос делается на получение всех звонков с учетки и сохранение их в переменную(переделать на уровне базы данных можно). Если звонки есть - кидает на отрисовку первой страницы.
##### drawClientCalls(page)
Сама отрисовка звонков, постраничная, звонков на странице <=50. Сначала осуществляется проверка на количество звонков и страниц, соответственно. Если страниц больше чем одна, строится пагинатор со своей логикой внизу и вверху.
Логика:
1. подсветка активной страницы
2. Проверка isFirstPage и isLastPage, чтобы отключить возможность нажимать на кнопки >> и << .
3. Максимальное количество страниц - 20, остальные просто не отображаются. Количество звонков максимальное - 50*20 = 1000
Потом идет цикл отрисовки звонков. Стандартный. Соединение нескольких звонков в один, отступы итд + подсветка твоих звонков, вывод комментариев и тэгов справа от звонка(именно для этого и нужно увеличение ширины экрана на всю доступную область).
##### collectTagForGetCalls(data)
сбор тэгов для отрисовки в звонках пользователя
##### addButton()
Отрисовка кнопки для вывода звонков в html-разметке. Также обработка события нажатия клавиши enter+переключатель Мои звонки\ Все звонки и его логика
___ 

### fireFeedback.js
#### Файл, отвечающий за отрисовку страницы feedback в firecatcher
#### Функции
1.  [createTagsTable()](index.md#createtagstable)
2.  [collectInfo()](index.md#collectinfo)
3.  [isInfoCorrect()](index.md#isinfocorrect)
4.  [postFeedback()](index.md#postfeedback)
5.  [clearFeedback()](index.md#clearfeedback)
6.  [drawFeedback()](index.md#drawfeedback)

#### Глобальные переменные
lengthOfTagGroup - количество выбранных агентом тэгов.
outputTags - JSONовская инфа, которая будет отправлена в базу, формируется при выборе какого-либо тэга.
##### createTagsTable()
начальная функция, которая отвечает за запрос к базе по группам тэгов, хранение этой информации и отрисовке всего блока feedback. Пробегаясь циклом по информации из запроса строится feedback, обходя стороной группы Main, пустые группы и User Satisfaction,  + блок комментариев + кнопка отправки, на которой висит событие сбора полученных данных -> collectInfo()
##### collectInfo()
переходная функция, в которой собирается информация о выделенных тэгах, пробегая по всем отрисованным лейблам в цикле, плюсуя выделенные и формируя JSON текст для отправки. После этого запрос переходит в функцию isInfoCorrect()
##### isInfoCorrect()
Проверка корректности информации и ее отправка, в случае успеха. Алгоритм:
1. Очистка полей ввода от выделения.
2. Проверка - выбран ли звонок, если нет, то вывод ошибки, если да, то ---
3. Проверка количества выбранных тэгов (подсветка в случае 0)
4. Проверка введен ли комментарий (подсветка в случае "")
5. Если проверки провалены - ошибка, если нет --v
6. Вызов функции postFeedback()
7. сброс сообщения об ошибке
8. Отрисовка значков о количестве незаполненных звонков\фидбеков
9. Отрисовка страницы фидбек

##### postFeedback()
Функция отправки данных на сервер, очень простая, поле-значение.
##### clearFeedback()
функция сброса всех значений на пустые\незаполненные
##### drawFeedback()
Отрисовка фидбека, алгоритм:
1. clearFeedback()
2. запрос к базе, запись в переменную полученных данных
3. проход по циклу и отрисовка звонков. Стандартная. С мультизвонками, данными на звонке итд. Добавляется только сбор уже проставленных тэгов в звонке в спец. переменной.
___
### notesAndComments.js
Отвечает за все, что связано с работой заметок и комментариев. 
#### Функции
1.  [document.ready()](index.md#nac-documentready)
2.  [getComments()](index.md#getcomments)
3.  [changeHeight(i)](index.md#changeheighti)
4.  [postComment()](index.md#postcomment)
5.  [updateNotes()](index.md#updatenotes)
6.  [getNotes()](index.md#getnotes)

##### nac-document.ready()
Здесь, в основном, прописана логика по нажатиям на кнопки Комментарии и Заметки. Алгоритм:
1. Убрать с противоположной "сущности" активный класс, включить "сущность" выбранную.
2. Поменять классы стрелок.
3. Отрисовать нужное

Также здесь прописана логика нажатия кнопки enter в поиске комментариев и обновления заметок.
##### getComments()
функция отвечающая за отрисовку комментариев. Алгоритм:
1. Получение значения номера учетной записи
2. Проверка не пустая ли она
2.1. Красная подсветка номера ID. Выход из алгоритма.
3. Запрос к базе
4. Обнуление переменных, сброс стилей
5. Отрисовка основного блока (таблица+кнопка добавления)
6. Отрисовка комментариев при наличии, в цикле
6.1. Вывод текста об отсутствии комментариев
7. Проверка на "длину" комментария, добавление спец. класса к длинным сообщениям, добавление функции changeHeight(i) при нажатии.

##### changeHeight(i)
Функция "разворачивания" длинных комментариев при нажатии на них. Сравнивает длину допустимую в блоке и реальную скролл.длину сообщения. Обрезает при превышении и делает цвет синим. При нажатии все возвращает и меняет цвет на черный. 
##### postComment()
Сброс всех подсветок и две проверки (id, комментарий). Если все корректно - отправляй инфу и обновление таблицы, если нет - подсветка некорректно введенной информации.
##### updateNotes()
просто отправка данных
##### getNotes()
Просто получение данных
___
### todayCallsController.js
#### Функции
1.  [document.ready()](index.md#tcc-documentready)
2.  [drawDayCalls(timeStart,timeEnd)](index.md#drawdaycallstimestarttimeend)
3.  [setInfoToCallForm(fullCallInfo)](index.md#setinfotocallformfullcallinfo)

#### Глобальные переменные
1. fullCallInfo
2. timeStart, timeEnd
3. tempDate, todayEnd

##### tcc-document.ready()
отрисовка кнопки и календаря + очистка данных + звонки\ feedback бейджи. Алгоритм:
1. Установка переменной отрисовки звонков в day
2. Очистка данных
3. Установка переменной todayStart
4. Отрисовка тэгов под звонками
5. Старт календаря
6. отрисовка календаря и "сегодня"
7. "включение" боковой формы
8. отрисовка бейджей

##### drawDayCalls(timeStart,timeEnd)
Основная функция отрисовки звонков. Алгоритм:
1. По указанным датам происходит get запрос к базе и сортировка
2. Если звонки есть - происходит отрисовка
2.1. Если нет - надпись "Звонки не обнаружены"
3. запускается цикл отрисовки всех звонков
4. Выполнение функции сбора дополнительной информации
5. Сбор тэгов
6. Установка переменных и массива fullCallInfo
7. склейка звонка в один + отступы
8. сбор всей получившейся информации
9. Вывод информации
10. bind аудиозаписей на события play и click

##### setInfoToCallForm(fullCallInfo)
Большая функция, смысл которой все собранные данные отрисовать в боковую панель. ID, категория, вопрос, клиент\менеджер, happy\unhappy, тэги, комментарий, частник
___
### websocket.js
Все, связанное с вебсокетами. Названия функций достаточно очевидные, поэтому тут особо расписывать даже нечего.
#### Функции
1.  [startConnection()](index.md#startconnection)
2.  [sendWebSocketMessage(message)](index.md#sendwebsocketmessagemessage)
3.  [getWebsocketMessage(callback)](index.md#getwebsocketmessagecallback)
4.  [online()](index.md#online)
5.  [setWebSocketStatus()](index.md#online)

#### Переменные
Только локальные.

### navbar.js
#### Функции
1.  [document.ready()](index.md#nav-documentready)
2.  [showMyEmptyCalls()](index.md#showmyemptycalls)
3.  [fillInfo(callForm,headerText,MainForm)](index.md#fillinfocallformheadertextmainform)
4.  [collectAdditionalInfo(data,type)](index.md#collectadditionalinfodatatype)
5.  [clearData()](index.md#cleardata)
6.  [fillData(dataArray)](index.md#filldatadataarray)
7.  [changeCall(callInfo)](index.md#changecallcallinfo)
8.  [collectTags(feedOrCall)](index.md#collecttagsfeedorcall)
9.  [draw(data)](index.md#drawdata)
10. [stopAll(e)](index.md#stopalle)
11. [drawAdditionalTags()](index.md#drawadditionaltags)
12. [drawBadges()](index.md#drawbadges)

#### Переменные
1. chainId - Нужна для передачи при смене звонка, чтобы заносить корректную информацию
2. tagsString - строка тэгов для заполнения звонка.
3. tagBuffer - буферная переменная для тэгов
4. agentName и agentId - имя и ID агента, берутся из ответа в запросе от вебсокета, записывается при сохранении звонка
5. idSaver - буферная переменная
6. dataArray - массив для отправки информации о звонке
7. additionalTags - выбранные до заполнения фидбека тэги
8. dayOrEmpty - переключатель для отрисовки звонков, пустых или звонков за день
9. callInfo - массив с инфой о звонке
10. sentCall - "отправка" звонка
11. questNum|catNum - вопрос/категория звонка
12. comFormat - формат показа комментариев
13. happy|unhappy - переменные с числовым значением этих тэгов. Высчитываются дальше
14. isHappy - дефолтное значение для тогглера счастья

#### nav-document.ready()
1. magic.click() - включение\выключение css дополнительной
2. ('#openQuestionLabel').click() - если общий вопрос - id=100
3. $('input[name="question|category"]').change - две функции, одна суть. При изменении категории/вопроса - меняй значение переменных.
4. $('#IsManagerDiv').click() - проверка, нажата ли кнопка менеджер, если да - появляется кнопка Без ID, если нажата повторна - скрывается и обнуляется ID
5. $("#private").click() - логика кнопки частник. Отправка стандартных значений
6. $('#sendDataButton').click() - кнопка отправить. Проверка корректности и полноты информации, заполнение массива, отправка, обновление страницы.
7. $('li.hl').click() - подсветка
8. $('#emptyCalls').click() - Незаполненные логика

#### showMyEmptyCalls()
Функция, отправляющая запрос по ws, получает данные JSON и отдает их на отрисовку draw()
#### fillInfo(callForm,headerText,MainForm)
Стандартная отрисовка после нажатия на кнопку бокового меню, для удобства читабельности. Форма звонка(вкл\выкл), текст заголовка страницы, текст основного меню
#### collectAdditionalInfo(data,type)
Функция пробегается по всем параметрам звонка и выводит их при отрисовке звонка. Возвращает полностью собранную html разметку.
1. Заполненный/пустой
2. Менеджер/клиент/частник
3. Исходящий
4. Фидбек заполненный/пустой
5. Категория/вопрос
6. ID

#### clearData()
Просто очистка всех возможных полей/кнопок/переключателей/классов
#### fillData(dataArray)
Отправка данных из боковой формы на сервер
#### changeCall(callInfo)
Выбор звонка, сохранение тэгов, применение класса к активному, очистка у всех остальных, сохранение комментария(если в фидбеке)
#### collectTags(feedOrCall)
Проверка и сборка тегов, от фидбека или обычного звонка
#### draw(data)
Основная отрисовка пустых звонков. Алгоритм:
1. Сортировка
2. заполнение данных
3. Проверка, есть ли звонки
4. dayOrEmpty = "empty" для обновления страницы в дальнейшем
5. Стандартная отрисовка в цикле, с мультизвонками, доп. данными, отступами итд
6. бинд звонков на события клик и плей
7. Отрисовка бейджей звонки\фидбек

#### stopAll(e)
Функция по остановке всех остальных аудио-файлов.
#### drawAdditionalTags()
Отрисовка доп. тэгов. Алгоритм\логика:
1. get запрос к базе на получение группы Main и Satisfaction
2. Нахождение количества тэгов в main группе и необходимого количества строк(длина\4)
3. Отрисовка в цикле, в зависимости от длины. Если кратно 4 - количество\4 строк, если при деление на 4 остаток 3 - количество тэгов\4 + следующей строка из 3 позиций, заполняя всю ширину, если остаток 2 - то же самое, но последняя строка уже и с отступами, если остаток 1 - еще уже и последняя строка с большим отступом.

#### drawBadges()
Отрисовка количество звонков\фидбеков незаполненных. Просто делает два запроса и считает уникальные comId. Если есть звонки незаполненные также меняет иконку.
___
# css files
## Написанные
### [sidebar.css](index.md#sidebarcss-1)
### [callform.css](index.md#callformcss-1)
### [NotesAndComments.css](index.md#notesandcommentscss-1)
### [feedbackTagsMain.css](index.md#feedbacktagsmaincss-1)
### [feedbackTagsFirecatcher.css](index.md#feedbacktagsfirecatchercss-1)
### [calls.css](index.md#callscss-1)
### [standartAdditionalColours.css](index.md#standartadditionalcolourscss-1)
### [mainWorkPlace.css](index.md#mainworkplacecss-1)
### [colours.css](index.md#colourscss-1)
___
## Внешние 
### bootstrap.css (3.3.7)
### daterangepicker (2)
### font-awesome.min.css(4.7.0)
### bootstrap-toggle.min.css (2.2.2)
___
### sidebar.css
Содержит в себе все стили, связанные с левой панели навигации.
### callform.css
Правая панель заполнения данных
### NotesAndComments.css
Заметки и комментарии
### feedbackTagsMain.css
Общие правила для фидбека
### feedbackTagsFirecatcher.css
Отображение фидбека в кетчере. В основном изменения только в расположении части элементов и в направлении "роста" флекса.
### calls.css
общий файл для отрисовки звонка. Содержит в себе всю информацию - как звонок рисуется(.call), как он выглядит активным(.call.active), аудио-тэг (.audio-call), отступы (.no-margin-top), подсветка твоих звонков (.yourCall) , дополнительная информация на звонках (.myLabel, .myLabel>a, mylabel>a:link|visited) и комментариев к звонкам (.might-overflow|:hover, .commentBox)
### standartAdditionalColours.css
Дополнительные цвета для кнопок
### mainWorkPlace.css
Все, что связанное с основной рабочей областью.
### colours.css
Стильные, модные, молодежные Авито цвета. MAAAAGIC
___
# jsp file
## admin.jsp
Страница включает в себя:
1. Основная обертка. #wrapper
2. Боковая навигационная панель со списком из 8 пунктов и онлайн статуса #sidebar-wrapper
3. Боковая форма для заполнения звонков (id-частник, категория, вопрос, тумблеры, доп. тэги, комментарий, кнопка отправки) #SubForm
4. Пустое поле для отрисовки туда фидбека #FeedbackForm
5. Обертка рабочей области, которая состоит из приветствия(#Hello), поля для звонков и основного поля(#MainForm) #page-content-wrapper 
6. Заметки #noteForm
7. Комментарии #commentForm













